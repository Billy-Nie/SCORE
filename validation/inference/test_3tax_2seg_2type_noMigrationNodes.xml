<beast version="2.0"
       namespace="beast.core
                 :beast.core.util
                 :beast.core.parameter
                 :beast.evolution.alignment
                 :beast.evolution.likelihood
                 :beast.evolution.tree
                 :beast.evolution.tree.coalescent
                 :beast.evolution.sitemodel
                 :beast.evolution.substitutionmodel
                 :beast.evolution.operators
                 :beast.math.distributions
                 :feast.simulation
		 :feast.fileio
                 :coalre.network
                 :coalre.statistics
                 :coalre.simulator
                 :coalre.operators
                 :coalre.distribution
		 :beast.mascotextended.structuredcoalescentnetwork.distribution
		 :beast.mascotextended.structuredcoalescentnetwork.simulator
		 :beast.mascotextended.structuredcoalescentnetwork.math
		 :structuredCoalescentNetwork.distribution
		 :structuredCoalescentNetwork.simulator
		 :structuredCoalescentNetwork.math">

    <alignment id="seg1align" spec="AlignmentFromNexus" fileName="simulate_3tax_2seg_2type_noMigrationNodes.seg1.alignment.nexus"/>
    <alignment id="seg2align" spec="AlignmentFromNexus" fileName="simulate_3tax_2seg_2type_noMigrationNodes.seg2.alignment.nexus"/>

    <taxonset id="taxonSet" spec="TaxonSet">
        <taxon spec="Taxon" id="t1"/>
        <taxon spec="Taxon" id="t2"/>
        <taxon spec="Taxon" id="t3"/>

    </taxonset>

    <traitSet spec="TraitSet" traitname="date-backward" id="traitSet">
    	t1=0, t2=0.1, t3=0.2
	<taxa idref="taxonSet"/>
    </traitSet>

	<typeTrait spec="TraitSet" traitname="type" id="typeTrait">
		t1=0, t2=0, t3=1
		<taxa idref="taxonSet"/>
	</typeTrait>

    <run spec="MCMC" chainLength="100000000"> 

        <state>
            <stateNode id="seg1tree" spec="Tree" taxonset="@taxonSet" trait="@traitSet"/>
            <stateNode id="seg2tree" spec="Tree" taxonset="@taxonSet" trait="@traitSet"/>
            <stateNode id="reassortmentRate" spec="RealParameter" dimension="2" value="0.1"/>
			<stateNode id="migrationRate" spec="RealParameter" dimension="2" value="0.5"/>
            <stateNode id="clockRate" spec="RealParameter" value="0.05"/>
            <stateNode id="coalescentRate" spec="RealParameter"  dimension="2" value="1.0"/>
<!--			<stateNode id="popSize" spec="RealParameter" value="1.0"/>-->

            <stateNode id="network" spec="SimulateStructureCoalescentNetwork" nSegments="2" ignoreMigrationNodes="true" 						enableSegmentTreeUpdate="false">
				<traitSet idref="traitSet"/>
				<typeTrait idref="typeTrait"/>
	
                 <Ne spec="RealParameter" id="Ne" dimension="2" value="1.0"/>
   
        		<reassortmentRate spec="RealParameter" dimension="2" value="0.1"/>
				<migrationRate spec="RealParameter" dimension="2" value="0.1"/>
				<coalescentRate spec="RealParameter" dimension="2" value="1.0"/>

            </stateNode>
        </state>

        <init spec="SegmentTreeInitializer" network="@network">
            <segmentTree idref="seg1tree"/>
            <segmentTree idref="seg2tree"/>
        </init>

        <distribution id="posterior" spec="CompoundDistribution">

            <distribution id="likelihood" spec="CompoundDistribution">
                <distribution spec="TreeLikelihood">
                    <data idref="seg1align"/>
                    <tree idref="seg1tree"/>
                    <siteModel spec="SiteModel" mutationRate="@clockRate">
                        <substModel spec="JukesCantor"/>
                    </siteModel>
                </distribution>

                <distribution spec="TreeLikelihood">
                    <data idref="seg2align"/>
                    <tree idref="seg2tree"/>
                    <siteModel spec="SiteModel" mutationRate="@clockRate">
                        <substModel spec="JukesCantor"/>
                    </siteModel>
                </distribution>
            </distribution>

 			<distribution id="prior" spec="CompoundDistribution">
                <distribution id="networkPrior" spec="ExactStructuredCoalescentNetwork" dim="2">
					<networkIntervals spec="StructuredNetworkIntervals" id="StructuredNetworkIntervals" network="@network"/>
						
						<typeTrait idref="typeTrait"/>
						<parameter id="stepSize" name="timeStep">0.001</parameter>
						<reassortmentRate idref="reassortmentRate"/>
						<coalescentRate idref="coalescentRate"/>
						<migrationRate idref="migrationRate"/>
				</distribution>

				<distribution id="parametersPrior" spec="CompoundDistribution">
                    <distribution spec="Prior" x="@reassortmentRate">
                        <!--distr spec="beast.math.distributions.Uniform" lower="0.0" upper="10.0"/-->
                        <distr spec="beast.math.distributions.OneOnX"/>
                    </distribution>

                    <distribution spec="Prior" x="@migrationRate">
                        <!--distr spec="beast.math.distributions.Uniform" lower="0.0" upper="1.0"/-->
                        <distr spec="beast.math.distributions.OneOnX"/>
                    </distribution>

					<distribution spec="Prior" x="@coalescentRate">
                        <!--distr spec="beast.math.distributions.Uniform" lower="0.0" upper="1.0"/-->
                        <distr spec="beast.math.distributions.OneOnX"/>
                    </distribution>

                    <distribution spec="Prior" x="@clockRate">
                        <!--distr spec="beast.math.distributions.Uniform" lower="0.0" upper="1.0"/-->
                        <distr spec="beast.math.distributions.OneOnX"/>
                    </distribution>

<!--                    <distribution spec="Prior" x="@popSize">-->
                        <!--distr spec="beast.math.distributions.Uniform" lower="0.0" upper="10.0"/-->
<!--                        <distr spec="beast.math.distributions.OneOnX"/>-->
<!--                    </distribution>-->
                </distribution>
            </distribution>

        </distribution>


        <!-- Parameter Operators -->

        <operator spec="ScaleOperator" parameter="@reassortmentRate" scaleFactor="0.5" weight="1.0"/>
	<operator spec="ScaleOperator" parameter="@migrationRate" scaleFactor="0.5" weight="1.0"/>
	<operator spec="ScaleOperator" parameter="@coalescentRate" scaleFactor="0.5" weight="1.0"/>
        <operator spec="ScaleOperator" parameter="@clockRate" scaleFactor="0.5" weight="1.0"/>
<!--        <operator spec="ScaleOperator" parameter="@popSize" scaleFactor="0.5" weight="1.0"/>-->


        <operator id="upDownOperator" spec="NetworkScaleOperator"
                  network="@network" weight="1.0">
            <segmentTree idref="seg1tree"/>
            <segmentTree idref="seg2tree"/>
<!--            <upParameter idref="popSize"/>-->
            <downParameter idref="clockRate"/>
            <downParameter idref="reassortmentRate"/>
			<downParameter idref="migrationRate"/>
			<downParameter idref="coalescentRate"/>
        </operator>

        <!-- Network Operators -->

        <operator spec="AddRemoveReassortment" network="@network" alpha="1.0" weight="1.0">
            <segmentTree idref="seg1tree"/>
            <segmentTree idref="seg2tree"/>
        </operator>

        <operator spec="DivertSegmentOperator" network="@network" weight="1.0">
            <segmentTree idref="seg1tree"/>
            <segmentTree idref="seg2tree"/>
        </operator>

        <operator spec="UniformNetworkNodeHeightOperator" network="@network" weight="1.0">
            <segmentTree idref="seg1tree"/>
            <segmentTree idref="seg2tree"/>
        </operator>

        <operator id="NetworkScale" spec="NetworkScaleOperator"
                  	network="@network" weight="1.0">
            <segmentTree idref="seg1tree"/>
            <segmentTree idref="seg2tree"/>
        </operator>

        <operator id="NetworkScaleRootOnly" spec="NetworkScaleOperator"
					network="@network" scaleRootOnly="true" weight="1.0">
            <segmentTree idref="seg1tree"/>
            <segmentTree idref="seg2tree"/>
        </operator>

	<operator id="NetworkExchange_Narrow" spec="NetworkExchange"
					network="@network" isNarrow="true" weight="1.0">
            <segmentTree idref="seg1tree"/>
            <segmentTree idref="seg2tree"/>
        </operator>

	<operator id="NetworkExchange_Wide" spec="NetworkExchange" 
					network="@network" isNarrow="false" weight="1.0">
            <segmentTree idref="seg1tree"/>
            <segmentTree idref="seg2tree"/>
        </operator>

        <logger spec="Logger" logEvery="10000" fileName="$(filebase).log">
            <log idref="posterior"/>
            <log idref="likelihood"/>
            <log spec="NetworkStatsLogger" network="@network"/>
            <log spec="TreeStatLogger" tree="@seg1tree"/>
            <log spec="TreeStatLogger" tree="@seg2tree"/>
            <log idref="reassortmentRate"/>
			<log idref="migrationRate"/>
			<log idref="coalescentRate"/>
            <log idref="clockRate"/>
<!--            <log idref="popSize"/>-->
        </logger>

        <logger spec="Logger" logEvery="100">
            <log idref="posterior"/>
            <log idref="likelihood"/>
            <log idref="networkPrior"/>
            <log idref="parametersPrior"/>
            <log spec="NetworkStatsLogger" network="@network"/>
            <log idref="reassortmentRate"/>
			<log idref="migrationRate"/>
			<log idref="coalescentRate"/>
            <log idref="clockRate"/>
<!--            <log idref="popSize"/>-->
            <log spec="ESS" arg="@posterior"/>
        </logger>

    </run>
</beast>

